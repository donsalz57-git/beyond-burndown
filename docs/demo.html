<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beyond Burndown - Guided Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --green: #00875A;
      --yellow: #FF8B00;
      --red: #DE350B;
      --blue: #0052CC;
      --gray: #5E6C84;
      --light-gray: #F4F5F7;
      --border: #DFE1E6;
      --text: #172B4D;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: #f0f0f0; color: var(--text); }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--green), #006644);
      color: white;
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 200;
    }
    .header h1 { font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
    .header a { color: white; text-decoration: none; font-size: 0.85rem; }

    /* Layout */
    .layout { display: flex; min-height: 100vh; padding-top: 52px; }

    /* Guide Panel */
    .guide {
      width: 420px;
      background: white;
      border-right: 1px solid var(--border);
      position: fixed;
      top: 52px;
      left: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      z-index: 100;
    }
    .guide-header {
      padding: 16px 20px;
      background: var(--light-gray);
      border-bottom: 1px solid var(--border);
    }
    .progress-bar {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      margin-bottom: 8px;
    }
    .progress-fill {
      height: 100%;
      background: var(--green);
      border-radius: 3px;
      transition: width 0.3s;
    }
    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--gray);
    }
    .guide-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .step-num {
      display: inline-block;
      background: var(--green);
      color: white;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 4px 12px;
      border-radius: 12px;
      margin-bottom: 16px;
    }
    .guide-body h2 {
      font-size: 1.4rem;
      margin-bottom: 16px;
    }
    .explanation {
      background: #F0F7FF;
      border-left: 4px solid var(--blue);
      padding: 16px;
      margin: 16px 0;
      border-radius: 0 8px 8px 0;
    }
    .explanation h3 {
      font-size: 0.85rem;
      color: var(--blue);
      margin-bottom: 8px;
    }
    .explanation p {
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text);
    }
    .details {
      margin: 20px 0;
    }
    .details h3 {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 12px;
      letter-spacing: 0.5px;
    }
    .details ul {
      list-style: none;
    }
    .details li {
      padding: 10px 0 10px 28px;
      position: relative;
      font-size: 0.9rem;
      line-height: 1.5;
      border-bottom: 1px solid var(--light-gray);
    }
    .details li:last-child { border-bottom: none; }
    .details li::before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: var(--green);
      font-weight: bold;
    }
    .action-box {
      background: #E3FCEF;
      border: 1px solid var(--green);
      border-radius: 8px;
      padding: 16px;
      margin: 20px 0;
    }
    .action-box h3 {
      font-size: 0.85rem;
      color: var(--green);
      margin-bottom: 8px;
    }
    .action-box p {
      font-size: 0.9rem;
      line-height: 1.5;
    }
    .guide-nav {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
    }
    .guide-nav button {
      flex: 1;
      padding: 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    .btn-prev { background: var(--light-gray); color: var(--gray); }
    .btn-prev:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-next { background: var(--green); color: white; }

    /* Gadget Panel */
    .gadget-area {
      flex: 1;
      margin-left: 420px;
      padding: 20px;
    }
    .gadget {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 900px;
    }

    /* Highlight */
    .highlight {
      animation: pulse 2s infinite;
      outline: 3px solid var(--green);
      outline-offset: 2px;
      border-radius: 6px;
    }
    @keyframes pulse {
      0%, 100% { outline-color: var(--green); }
      50% { outline-color: transparent; }
    }

    /* Summary Bar */
    .summary {
      display: flex;
      gap: 24px;
      padding: 14px 20px;
      background: var(--light-gray);
      border-bottom: 1px solid var(--border);
    }
    .metric { text-align: center; min-width: 70px; }
    .metric-val { font-size: 1.3rem; font-weight: 700; }
    .metric-val.ok { color: var(--green); }
    .metric-val.warn { color: var(--yellow); }
    .metric-val.bad { color: var(--red); }
    .metric-label { font-size: 0.65rem; color: var(--gray); text-transform: uppercase; }

    /* Alert */
    .alert {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      border-bottom: 1px solid var(--border);
    }
    .alert.warn { background: #FFFAE6; border-left: 4px solid var(--yellow); }
    .alert.bad { background: #FFEBE6; border-left: 4px solid var(--red); }

    /* Tabs */
    .tabs {
      display: flex;
      padding: 0 20px;
      border-bottom: 2px solid var(--border);
      background: white;
    }
    .tab {
      padding: 14px 16px;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--gray);
      cursor: pointer;
      border: none;
      background: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--green); border-bottom-color: var(--green); }
    .badge { background: var(--gray); color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; }
    .badge.bad { background: var(--red); }

    .content { padding: 20px; min-height: 420px; }
    .panel { display: none; }
    .panel.active { display: block; }

    /* Feasibility */
    .feas-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
    .score { font-size: 2rem; font-weight: 700; }
    .score-label { font-size: 0.9rem; color: var(--gray); margin-left: 8px; }
    .controls { display: flex; gap: 10px; align-items: center; }
    .controls select, .controls button {
      padding: 8px 14px;
      border: 2px solid var(--border);
      border-radius: 4px;
      font-size: 0.8rem;
      background: white;
      cursor: pointer;
    }
    .controls button.active { background: var(--blue); color: white; border-color: var(--blue); }
    .warn-bar {
      background: #FFEBE6;
      border-left: 4px solid var(--red);
      padding: 10px 14px;
      margin-bottom: 16px;
      border-radius: 0 6px 6px 0;
      font-size: 0.85rem;
    }
    .chart-box { height: 260px; margin: 20px 0; }
    .legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px 20px;
      padding: 12px;
      background: #FAFBFC;
      border-radius: 6px;
    }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; color: var(--gray); white-space: nowrap; }
    .legend-color { width: 20px; height: 3px; border-radius: 2px; }

    /* What-If */
    .whatif {
      background: var(--light-gray);
      border-radius: 8px;
      padding: 16px;
      margin-top: 20px;
    }
    .whatif h4 { margin-bottom: 14px; font-size: 0.95rem; }
    .scenario-tabs { display: flex; gap: 6px; margin-bottom: 14px; }
    .scenario-tabs button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .scenario-tabs button.active { background: var(--blue); color: white; font-weight: 600; }
    .scenario-tabs button:not(.active) { background: white; color: var(--gray); }
    .scenario-input { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; flex-wrap: wrap; }
    .scenario-input input {
      width: 60px;
      padding: 8px;
      text-align: center;
      border: 2px solid var(--border);
      border-radius: 4px;
    }
    .scenario-result {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .scenario-result .preview { font-size: 0.9rem; }
    .scenario-result button {
      padding: 10px 20px;
      background: var(--blue);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Team */
    .team-list { display: flex; flex-direction: column; gap: 12px; }
    .team-member {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: var(--light-gray);
      border-radius: 8px;
    }
    .avatar {
      width: 48px;
      height: 48px;
      background: var(--green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
    }
    .member-info { flex: 1; }
    .member-name { font-weight: 600; margin-bottom: 4px; }
    .member-stats { display: flex; gap: 16px; font-size: 0.8rem; color: var(--gray); }
    .load-bar { height: 8px; background: var(--border); border-radius: 4px; margin-top: 8px; }
    .load-fill { height: 100%; border-radius: 4px; }
    .load-fill.ok { background: var(--green); }
    .load-fill.warn { background: var(--yellow); }
    .load-fill.bad { background: var(--red); }
    .status-tag {
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-tag.ok { background: #E3FCEF; color: var(--green); }
    .status-tag.bad { background: #FFEBE6; color: var(--red); }
    .status-tag.warn { background: #FFFAE6; color: var(--yellow); }

    /* Capacity */
    .cap-config { max-width: 500px; }
    .cap-row { margin-bottom: 20px; }
    .cap-row label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 8px; }
    .cap-toggle { display: flex; gap: 6px; }
    .cap-toggle button {
      flex: 1;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: 6px;
      background: white;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .cap-toggle button.active {
      border-color: var(--green);
      background: #E3FCEF;
      color: var(--green);
      font-weight: 600;
    }
    .cap-list { margin-top: 20px; }
    .cap-header {
      display: grid;
      grid-template-columns: 1fr 100px 50px;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray);
      text-transform: uppercase;
    }
    .cap-member {
      display: grid;
      grid-template-columns: 1fr 100px 50px;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--light-gray);
      align-items: center;
    }
    .cap-member input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 4px;
      text-align: center;
    }
    .cap-member button {
      background: none;
      border: none;
      color: var(--red);
      font-size: 1.2rem;
      cursor: pointer;
    }
    .cap-total {
      margin-top: 16px;
      padding: 14px;
      background: var(--light-gray);
      border-radius: 6px;
      font-size: 0.95rem;
    }
    .cap-total strong { color: var(--green); }
    .save-btn {
      margin-top: 16px;
      padding: 12px 24px;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Compliance */
    .comp-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
    .comp-card { background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center; }
    .comp-card .num { font-size: 2.5rem; font-weight: 700; }
    .comp-card .num.bad { color: var(--red); }
    .comp-card .num.warn { color: var(--yellow); }
    .comp-card .num.info { color: var(--blue); }
    .comp-card .lbl { font-size: 0.75rem; color: var(--gray); text-transform: uppercase; }
    .filters { display: flex; gap: 8px; margin-bottom: 16px; }
    .filters button {
      padding: 8px 14px;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: white;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .filters button.active { background: var(--blue); color: white; border-color: var(--blue); }
    .violation {
      display: flex;
      gap: 12px;
      padding: 14px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid var(--border);
    }
    .violation.error { background: #FFEBE6; border-left-color: var(--red); }
    .violation.warning { background: #FFFAE6; border-left-color: var(--yellow); }
    .violation.info { background: #DEEBFF; border-left-color: var(--blue); }
    .violation-icon { font-size: 1.2rem; }
    .violation-body { flex: 1; }
    .violation-key { font-weight: 600; color: var(--blue); }
    .violation-msg { font-size: 0.85rem; color: var(--gray); margin-top: 4px; }

    /* Dependencies */
    .dep-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
    .cycle-alert {
      background: #FFEBE6;
      border: 1px solid var(--red);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .cycle-alert h4 { color: var(--red); margin-bottom: 10px; }
    .cycle-path {
      background: white;
      padding: 10px 14px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 0.9rem;
    }
    .dep-list {
      border: 1px solid var(--border);
      border-radius: 8px;
      max-height: 280px;
      overflow-y: auto;
    }
    .dep-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--light-gray);
    }
    .dep-item:last-child { border-bottom: none; }
    .dep-depth {
      width: 28px;
      height: 28px;
      background: var(--green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .dep-key { font-weight: 600; color: var(--blue); min-width: 90px; }
    .dep-summary { color: var(--gray); font-size: 0.85rem; }

    /* Report */
    .report-section { margin-bottom: 28px; }
    .report-section h3 { font-size: 1.1rem; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
    .report-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .report-metric { padding: 16px; background: var(--light-gray); border-radius: 8px; }
    .report-metric .val { font-size: 1.6rem; font-weight: 700; }
    .report-metric .val.ok { color: var(--green); }
    .report-metric .val.warn { color: var(--yellow); }
    .report-metric .val.bad { color: var(--red); }
    .report-metric .lbl { font-size: 0.8rem; color: var(--gray); }
    .decision { padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid; }
    .decision.high { background: #FFEBE6; border-left-color: var(--red); }
    .decision.med { background: #FFFAE6; border-left-color: var(--yellow); }
    .decision-title { font-weight: 600; margin-bottom: 6px; }
    .decision-desc { font-size: 0.9rem; color: var(--gray); line-height: 1.5; }

    @media (max-width: 900px) {
      .guide { width: 340px; }
      .gadget-area { margin-left: 340px; }
    }
    @media (max-width: 768px) {
      .layout { flex-direction: column; }
      .guide { position: relative; width: 100%; top: 0; max-height: 50vh; }
      .gadget-area { margin-left: 0; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìä Beyond Burndown <span style="background:rgba(255,255,255,0.2);padding:3px 10px;border-radius:10px;font-size:0.7rem;margin-left:8px;">GUIDED DEMO</span></h1>
    <a href="index.html">‚Üê Back to Home</a>
  </div>

  <div class="layout">
    <!-- Guide Panel -->
    <div class="guide">
      <div class="guide-header">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <div class="progress-text">
          <span id="step-text">Step 1 of 14</span>
          <span id="step-name">Introduction</span>
        </div>
      </div>
      <div class="guide-body" id="guide-body"></div>
      <div class="guide-nav">
        <button class="btn-prev" id="prev-btn" onclick="prevStep()">Previous</button>
        <button class="btn-next" id="next-btn" onclick="nextStep()">Next Step</button>
      </div>
    </div>

    <!-- Gadget -->
    <div class="gadget-area">
      <div class="gadget">
        <div class="summary" id="summary-bar">
          <div class="metric"><div class="metric-val">18</div><div class="metric-label">Issues</div></div>
          <div class="metric"><div class="metric-val warn" id="feas-val">73%</div><div class="metric-label">Feasibility</div></div>
          <div class="metric"><div class="metric-val bad">9</div><div class="metric-label">Violations</div></div>
          <div class="metric"><div class="metric-val bad">1</div><div class="metric-label">Cycles</div></div>
        </div>

        <div class="alert warn" id="forecast-alert">
          ‚ö†Ô∏è <span>Forecast: Work completes Feb 18 ‚Äî <strong>2 days after deadline</strong></span>
        </div>

        <div class="tabs" id="tab-bar">
          <button class="tab active" data-tab="feasibility">Feasibility</button>
          <button class="tab" data-tab="team">Team <span class="badge bad">!</span></button>
          <button class="tab" data-tab="capacity">Capacity</button>
          <button class="tab" data-tab="compliance">Compliance <span class="badge">9</span></button>
          <button class="tab" data-tab="dependencies">Dependencies <span class="badge bad">1</span></button>
          <button class="tab" data-tab="report">Report</button>
        </div>

        <div class="content">
          <!-- Feasibility -->
          <div class="panel active" id="panel-feasibility">
            <div class="feas-header" id="feas-header">
              <div><span class="score" id="score" style="color:var(--yellow)">73%</span><span class="score-label">Feasibility Score</span></div>
              <div class="controls">
                <select id="period-select"><option>Daily</option><option>Weekly</option></select>
                <button id="whatif-btn" onclick="toggleWhatIf()">What-If</button>
              </div>
            </div>
            <div class="warn-bar" id="overload-bar">‚ö†Ô∏è <strong>Overloaded period:</strong> Feb 1‚Äì8 (6 days) ‚Äî demand exceeds capacity by up to 42 hours</div>
            <div class="chart-box"><canvas id="chart"></canvas></div>
            <div class="legend" id="chart-legend">
              <div class="legend-item"><div class="legend-color" style="background:#00875A"></div>Capacity</div>
              <div class="legend-item"><div class="legend-color" style="background:#0052CC"></div>Demand</div>
            </div>
            <div class="whatif" id="whatif-panel" style="display:none">
              <h4>What-If Scenario Modeling</h4>
              <div class="scenario-tabs">
                <button class="active">+ Add Capacity</button>
                <button>- Reduce Scope</button>
                <button>+ Extend Deadline</button>
              </div>
              <div class="scenario-input">
                <span>Add</span>
                <input type="number" value="1" min="1" max="5" id="dev-input">
                <span>developer(s) working</span>
                <input type="number" value="8" min="1" max="12" id="hrs-input">
                <span>hours/day</span>
              </div>
              <div class="scenario-result">
                <div class="preview"><strong style="color:var(--green)">+1 dev @ 8h/day</strong> ‚Üí Feasibility increases to <strong style="color:var(--green)">86%</strong></div>
                <button onclick="applyScenario()">Apply Scenario</button>
              </div>
            </div>
          </div>

          <!-- Team -->
          <div class="panel" id="panel-team">
            <div class="team-list" id="team-list"></div>
          </div>

          <!-- Capacity -->
          <div class="panel" id="panel-capacity">
            <div class="cap-config" id="cap-config">
              <div class="cap-row">
                <label>Capacity Type</label>
                <div class="cap-toggle">
                  <button onclick="setCapType('team')">Team Total</button>
                  <button class="active" onclick="setCapType('user')">Per User</button>
                </div>
              </div>
              <div class="cap-row">
                <label>Time Period</label>
                <div class="cap-toggle">
                  <button class="active" onclick="setCapPeriod('week')">Weekly</button>
                  <button onclick="setCapPeriod('month')">Monthly</button>
                </div>
              </div>
              <div class="cap-list">
                <div class="cap-header"><span>Team Member</span><span>Hours/Week</span><span></span></div>
                <div id="cap-members"></div>
              </div>
              <div class="cap-total">Total Team Capacity: <strong id="cap-total">152</strong> hours/week</div>
              <button class="save-btn" onclick="saveCapacity()">Save Capacity Configuration</button>
            </div>
          </div>

          <!-- Compliance -->
          <div class="panel" id="panel-compliance">
            <div class="comp-summary">
              <div class="comp-card"><div class="num bad">4</div><div class="lbl">Errors</div></div>
              <div class="comp-card"><div class="num warn">4</div><div class="lbl">Warnings</div></div>
              <div class="comp-card"><div class="num info">1</div><div class="lbl">Info</div></div>
            </div>
            <div class="filters" id="filters">
              <button class="active" data-f="all" onclick="filterV('all')">All (9)</button>
              <button data-f="error" onclick="filterV('error')">Errors (4)</button>
              <button data-f="warning" onclick="filterV('warning')">Warnings (4)</button>
            </div>
            <div id="violations"></div>
          </div>

          <!-- Dependencies -->
          <div class="panel" id="panel-dependencies">
            <div class="dep-stats">
              <div class="comp-card"><div class="num">12</div><div class="lbl">Issues</div></div>
              <div class="comp-card"><div class="num">5</div><div class="lbl">Max Depth</div></div>
              <div class="comp-card"><div class="num bad">1</div><div class="lbl">Cycles</div></div>
              <div class="comp-card"><div class="num">4</div><div class="lbl">Leaf Issues</div></div>
            </div>
            <div class="cycle-alert" id="cycle-alert">
              <h4>‚ö†Ô∏è Circular Dependency Detected</h4>
              <div class="cycle-path">DEMO-120 ‚Üí DEMO-121 ‚Üí DEMO-122 ‚Üí DEMO-120</div>
              <p style="margin-top:10px;font-size:0.85rem;color:var(--gray)">These issues block each other in a loop. Break one link to resolve.</p>
            </div>
            <h4 style="margin-bottom:12px">Dependency Chain (sorted by depth)</h4>
            <div class="dep-list" id="dep-list"></div>
          </div>

          <!-- Report -->
          <div class="panel" id="panel-report">
            <div class="report-section">
              <h3>Executive Summary</h3>
              <div class="report-grid" id="report-grid">
                <div class="report-metric"><div class="val warn">73%</div><div class="lbl">Feasibility</div></div>
                <div class="report-metric"><div class="val bad">101%</div><div class="lbl">Utilization</div></div>
                <div class="report-metric"><div class="val">5%</div><div class="lbl">Complete</div></div>
                <div class="report-metric"><div class="val bad">2 days</div><div class="lbl">Behind</div></div>
              </div>
            </div>
            <div class="report-section">
              <h3>Decisions Needed</h3>
              <div id="decisions">
                <div class="decision high"><div class="decision-title">Resolve Capacity Gap</div><div class="decision-desc">Demand exceeds capacity by 5 hours. Either add 1 developer, remove 5 hours of scope, or extend the deadline by 1 day.</div></div>
                <div class="decision high"><div class="decision-title">Break Circular Dependency</div><div class="decision-desc">DEMO-120/121/122 are blocking each other. Remove one blocking link to unblock 3 issues.</div></div>
                <div class="decision med"><div class="decision-title">Address Overdue Issues</div><div class="decision-desc">DEMO-103 and DEMO-107 are overdue. Reassign or adjust due dates.</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Steps with improved explanations
    const steps = [
      {
        name: 'Introduction',
        tab: 'feasibility',
        highlight: 'summary-bar',
        html: `
          <span class="step-num">Welcome</span>
          <h2>What is Beyond Burndown?</h2>

          <div class="explanation">
            <h3>The Problem It Solves</h3>
            <p>Traditional burndown charts only show if you're on track <em>today</em>. They don't tell you if you have enough capacity to finish everything by the deadline. Beyond Burndown answers: <strong>"Will we make it?"</strong></p>
          </div>

          <div class="details">
            <h3>The Summary Bar Shows</h3>
            <ul>
              <li><strong>18 Issues</strong> ‚Äî The total work items being analyzed</li>
              <li><strong>73% Feasibility</strong> ‚Äî You can complete 73% of planned work with current capacity. Yellow means at risk.</li>
              <li><strong>9 Violations</strong> ‚Äî Planning problems like missing dates, overdue issues, or scheduling conflicts</li>
              <li><strong>1 Cycle</strong> ‚Äî A circular dependency where issues block each other in a loop</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>What This Dashboard Tells You</h3>
            <p>Right now, this project is <strong>at risk</strong>. The team doesn't have enough capacity to complete all planned work by the deadline. The following steps will show you exactly where the problems are and how to fix them.</p>
          </div>
        `
      },
      {
        name: 'Forecast Alert',
        tab: 'feasibility',
        highlight: 'forecast-alert',
        html: `
          <span class="step-num">Step 2</span>
          <h2>The Forecast Alert</h2>

          <div class="explanation">
            <h3>What This Warning Means</h3>
            <p>Based on the current work estimates and team capacity, the analysis predicts when all work will be completed. This project will finish <strong>2 days late</strong>.</p>
          </div>

          <div class="details">
            <h3>How the Forecast Works</h3>
            <ul>
              <li>Calculates remaining work from Jira time estimates</li>
              <li>Divides by daily team capacity</li>
              <li>Projects completion date accounting for weekends</li>
              <li>Compares against issue due dates to find the gap</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>To Get Back on Track</h3>
            <p>You need to either: (1) Add more capacity, (2) Remove 5+ hours of scope, or (3) Extend the deadline. The What-If feature lets you model these options.</p>
          </div>
        `
      },
      {
        name: 'Feasibility Score',
        tab: 'feasibility',
        highlight: 'feas-header',
        html: `
          <span class="step-num">Step 3</span>
          <h2>The Feasibility Score</h2>

          <div class="explanation">
            <h3>What 73% Means</h3>
            <p>The feasibility score represents how much of the planned work can be completed with available capacity. At 73%, you can only deliver about <strong>three-quarters</strong> of what's planned.</p>
          </div>

          <div class="details">
            <h3>Score Calculation</h3>
            <ul>
              <li><strong>Total Capacity:</strong> 608 hours available until deadline</li>
              <li><strong>Total Demand:</strong> 613 hours of remaining work</li>
              <li><strong>Gap:</strong> 5 hours short (demand > capacity)</li>
              <li><strong>Penalty:</strong> Score reduced further for days where demand spikes above capacity</li>
            </ul>
          </div>

          <div class="details">
            <h3>Score Ranges</h3>
            <ul>
              <li><strong style="color:#00875A">80-100% (Green)</strong> ‚Äî On track, sufficient capacity</li>
              <li><strong style="color:#FF8B00">50-79% (Yellow)</strong> ‚Äî At risk, capacity is tight</li>
              <li><strong style="color:#DE350B">0-49% (Red)</strong> ‚Äî Critical, major cuts needed</li>
            </ul>
          </div>
        `
      },
      {
        name: 'Overload Detection',
        tab: 'feasibility',
        highlight: 'overload-bar',
        html: `
          <span class="step-num">Step 4</span>
          <h2>Overload Detection</h2>

          <div class="explanation">
            <h3>Identifying Problem Periods</h3>
            <p>Even if total capacity matches total demand, you can still have problems if work is unevenly distributed. This shows when the team will be <strong>overloaded</strong>.</p>
          </div>

          <div class="details">
            <h3>What the Warning Shows</h3>
            <ul>
              <li><strong>Feb 1‚Äì8:</strong> The specific dates when overload occurs</li>
              <li><strong>6 days:</strong> How many days are affected</li>
              <li><strong>42 hours over:</strong> The maximum daily overload (demand exceeding capacity)</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>How to Fix Overloads</h3>
            <p>Move work out of overloaded periods by adjusting start dates, or bring in temporary help during those specific dates. The chart below shows the full timeline.</p>
          </div>
        `
      },
      {
        name: 'Daily Demand vs Capacity',
        tab: 'feasibility',
        highlight: 'chart-legend',
        chartView: 'daily',
        html: `
          <span class="step-num">Step 5</span>
          <h2>Daily Demand vs Capacity</h2>

          <div class="explanation">
            <h3>Are You Overloaded Today?</h3>
            <p>This view compares how much work is due each day against how many hours the team can work that day.</p>
          </div>

          <div class="details">
            <h3>Reading the Lines</h3>
            <ul>
              <li><strong style="color:#00875A">Daily Capacity</strong> ‚Äî Hours your team can work per day (32h)</li>
              <li><strong style="color:#0052CC">Daily Demand</strong> ‚Äî Hours of work due that day</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Key Insight</h3>
            <p>When blue exceeds green, you have more work due than hours available. The early spike shows Feb 1-8 is overloaded ‚Äî too many issues due at once.</p>
          </div>
        `
      },
      {
        name: 'Cumulative Demand vs Capacity',
        tab: 'feasibility',
        highlight: 'chart-legend',
        chartView: 'cumulative',
        html: `
          <span class="step-num">Step 6</span>
          <h2>Cumulative Demand vs Capacity</h2>

          <div class="explanation">
            <h3>Will You Finish on Time?</h3>
            <p>This view shows running totals. If cumulative demand exceeds cumulative capacity, you won't complete all work by the deadline.</p>
          </div>

          <div class="details">
            <h3>Reading the Lines</h3>
            <ul>
              <li><strong style="color:#00875A">Cumulative Capacity</strong> ‚Äî Total hours available so far</li>
              <li><strong style="color:#0052CC">Cumulative Demand</strong> ‚Äî Total hours of work needed so far</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Key Insight</h3>
            <p>The gap at the end shows your shortfall. Here, demand (blue) ends ~5 hours above capacity (green) ‚Äî you need to cut scope or add capacity.</p>
          </div>
        `
      },
      {
        name: 'Time Spent vs Capacity',
        tab: 'feasibility',
        highlight: 'chart-legend',
        chartView: 'spent',
        html: `
          <span class="step-num">Step 7</span>
          <h2>Time Spent vs Capacity</h2>

          <div class="explanation">
            <h3>How Efficiently Are You Using Capacity?</h3>
            <p>This view compares actual logged time against available capacity to show how much of your capacity you're actually using.</p>
          </div>

          <div class="details">
            <h3>Reading the Lines</h3>
            <ul>
              <li><strong style="color:#00875A">Cumulative Capacity</strong> ‚Äî Total hours available so far</li>
              <li><strong style="color:#FF8B00">Time Spent</strong> ‚Äî Actual hours logged (from worklogs)</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Key Insight</h3>
            <p>Large gap = underutilization (team not logging full hours). Small gap = good utilization. If time spent exceeds capacity, something's wrong with estimates.</p>
          </div>
        `
      },
      {
        name: 'Completion Percentage',
        tab: 'feasibility',
        highlight: 'chart-legend',
        chartView: 'completion',
        html: `
          <span class="step-num">Step 8</span>
          <h2>Completion Percentage</h2>

          <div class="explanation">
            <h3>How Much Is Actually Done?</h3>
            <p>This shows progress as a percentage: time spent divided by original estimates. It tells you how close you are to finishing all planned work.</p>
          </div>

          <div class="details">
            <h3>Reading the Chart</h3>
            <ul>
              <li><strong style="color:#9C27B0">Completion %</strong> ‚Äî (Time Spent √∑ Original Estimate) √ó 100</li>
              <li>At 50% capacity used, you should be ~50% complete</li>
              <li>If completion lags behind capacity usage, estimates were too low</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Key Insight</h3>
            <p>Currently at ~85% complete with 95% of capacity used. The project is slightly behind but close to finishing.</p>
          </div>
        `
      },
      {
        name: 'What-If Analysis',
        tab: 'feasibility',
        highlight: 'whatif-btn',
        showWhatIf: true,
        chartView: 'cumulative',
        html: `
          <span class="step-num">Step 9</span>
          <h2>What-If Scenario Modeling</h2>

          <div class="explanation">
            <h3>Test Solutions Before Committing</h3>
            <p>Instead of guessing, model different scenarios to see exactly how each option affects your feasibility score.</p>
          </div>

          <div class="details">
            <h3>Three Types of Scenarios</h3>
            <ul>
              <li><strong>Add Capacity</strong> ‚Äî What if we add contractors or overtime? (+1 dev @ 8h/day = +160 hours)</li>
              <li><strong>Reduce Scope</strong> ‚Äî What if we cut features? (Remove 60 hours = +10% feasibility)</li>
              <li><strong>Extend Deadline</strong> ‚Äî What if we push the date? (+1 week = +160 hours capacity)</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Try It Now</h3>
            <p>The panel shows adding 1 developer would raise feasibility from 73% to 86%. You can combine scenarios to find the right mix.</p>
          </div>
        `
      },
      {
        name: 'Team Workload',
        tab: 'team',
        highlight: null,
        html: `
          <span class="step-num">Step 10</span>
          <h2>Team Workload Distribution</h2>

          <div class="explanation">
            <h3>Who's Overloaded?</h3>
            <p>The Team tab breaks down workload by person, showing who has too much work assigned and who has spare capacity.</p>
          </div>

          <div class="details">
            <h3>Understanding the Display</h3>
            <ul>
              <li><strong>Bar length</strong> ‚Äî Percentage of capacity used (over 100% = overloaded)</li>
              <li><strong style="color:#00875A">Green bar</strong> ‚Äî Healthy workload (under 90%)</li>
              <li><strong style="color:#FF8B00">Yellow bar</strong> ‚Äî Near capacity (90-100%)</li>
              <li><strong style="color:#DE350B">Red bar</strong> ‚Äî Overloaded (over 100%)</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Rebalancing Work</h3>
            <p>Bob (113%) and David (131%) are overloaded while Carol (75%) has spare capacity. Moving 40 hours from David to Carol would help.</p>
          </div>
        `
      },
      {
        name: 'Capacity Configuration',
        tab: 'capacity',
        highlight: 'cap-config',
        html: `
          <span class="step-num">Step 11</span>
          <h2>Capacity Configuration</h2>

          <div class="explanation">
            <h3>Defining Team Availability</h3>
            <p>This is where you tell Beyond Burndown how much capacity your team has. No more creating fake "capacity" issues in Jira.</p>
          </div>

          <div class="details">
            <h3>Configuration Options</h3>
            <ul>
              <li><strong>Team Total</strong> ‚Äî Enter one number for the whole team's weekly hours</li>
              <li><strong>Per User</strong> ‚Äî Enter hours for each team member individually</li>
              <li><strong>Weekly/Monthly</strong> ‚Äî Choose your planning period</li>
            </ul>
          </div>

          <div class="details">
            <h3>Current Configuration</h3>
            <ul>
              <li>Alice Chen: 40 hrs/week</li>
              <li>Bob Martinez: 40 hrs/week</li>
              <li>Carol Kim: 40 hrs/week</li>
              <li>David Patel: 32 hrs/week (part-time)</li>
              <li><strong>Total: 152 hrs/week</strong></li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Why This Matters</h3>
            <p>Accurate capacity is essential for accurate forecasting. Include PTO, meetings, and other non-project time when setting these values.</p>
          </div>
        `
      },
      {
        name: 'Compliance Violations',
        tab: 'compliance',
        highlight: null,
        html: `
          <span class="step-num">Step 12</span>
          <h2>Compliance Violations</h2>

          <div class="explanation">
            <h3>Finding Planning Problems</h3>
            <p>The compliance engine automatically detects issues with your Jira data that could cause problems ‚Äî missing information, scheduling conflicts, and overdue work.</p>
          </div>

          <div class="details">
            <h3>Violation Types Found</h3>
            <ul>
              <li><strong style="color:#DE350B">Overdue (2)</strong> ‚Äî DEMO-103 and DEMO-107 are past their due date</li>
              <li><strong style="color:#DE350B">Dependency conflict (1)</strong> ‚Äî DEMO-104 starts before its blocker finishes</li>
              <li><strong style="color:#DE350B">Child after parent (1)</strong> ‚Äî DEMO-111 is due after its parent Epic</li>
              <li><strong style="color:#FF8B00">Missing dates (2)</strong> ‚Äî DEMO-108, DEMO-112 have no due date</li>
              <li><strong style="color:#FF8B00">Missing estimates (2)</strong> ‚Äî DEMO-109, DEMO-116 have no time estimate</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Fixing Violations</h3>
            <p>Start with errors (red) ‚Äî they have the biggest impact on forecast accuracy. Warnings (yellow) should be addressed but are less critical.</p>
          </div>
        `
      },
      {
        name: 'Dependency Analysis',
        tab: 'dependencies',
        highlight: 'cycle-alert',
        html: `
          <span class="step-num">Step 13</span>
          <h2>Dependency Analysis</h2>

          <div class="explanation">
            <h3>Finding Blocking Chains</h3>
            <p>Beyond Burndown extracts blocking relationships from Jira and analyzes them to find problems like circular dependencies that make work impossible to complete.</p>
          </div>

          <div class="details">
            <h3>Circular Dependency Explained</h3>
            <ul>
              <li>DEMO-120 is blocked by DEMO-122</li>
              <li>DEMO-122 is blocked by DEMO-121</li>
              <li>DEMO-121 is blocked by DEMO-120</li>
              <li><strong>Result:</strong> None of these can ever start!</li>
            </ul>
          </div>

          <div class="details">
            <h3>Dependency Metrics</h3>
            <ul>
              <li><strong>Max Depth: 5</strong> ‚Äî Longest chain of sequential dependencies</li>
              <li><strong>Leaf Issues: 4</strong> ‚Äî Issues at the end of chains (final deliverables)</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Resolving the Cycle</h3>
            <p>Remove one blocking link to break the cycle. Often these are added by mistake or represent "nice to have" rather than true dependencies.</p>
          </div>
        `
      },
      {
        name: 'Executive Report',
        tab: 'report',
        highlight: 'report-grid',
        html: `
          <span class="step-num">Step 14</span>
          <h2>Executive Report</h2>

          <div class="explanation">
            <h3>Summary for Decision Makers</h3>
            <p>The Report tab consolidates all findings into actionable items with clear priorities.</p>
          </div>

          <div class="details">
            <h3>Key Metrics</h3>
            <ul>
              <li><strong>73% Feasibility</strong> ‚Äî At risk, not enough capacity</li>
              <li><strong>101% Utilization</strong> ‚Äî Team is slightly overcommitted</li>
              <li><strong>5% Complete</strong> ‚Äî Early in the project</li>
              <li><strong>2 Days Behind</strong> ‚Äî Current trajectory misses deadline</li>
            </ul>
          </div>

          <div class="details">
            <h3>Recommended Actions</h3>
            <ul>
              <li><strong>Priority 1:</strong> Break the circular dependency to unblock 3 issues</li>
              <li><strong>Priority 2:</strong> Add capacity or cut scope to close the 5-hour gap</li>
              <li><strong>Priority 3:</strong> Address 2 overdue issues</li>
            </ul>
          </div>

          <div class="action-box">
            <h3>Demo Complete!</h3>
            <p>You've seen all the key features. Beyond Burndown turns complex Jira data into clear, actionable insights.</p>
            <p style="margin-top:12px"><a href="https://marketplace.atlassian.com/" style="display:inline-block;padding:12px 24px;background:var(--green);color:white;text-decoration:none;border-radius:6px;font-weight:600;">Install on Your Jira</a></p>
          </div>
        `
      }
    ];

    // State
    let step = 0;
    let chart = null;

    // Data
    const team = [
      { name: 'Alice Chen', issues: 5, demand: 145, capacity: 160, load: 91, status: 'ok' },
      { name: 'Bob Martinez', issues: 6, demand: 180, capacity: 160, load: 113, status: 'bad' },
      { name: 'Carol Kim', issues: 4, demand: 120, capacity: 160, load: 75, status: 'warn' },
      { name: 'David Patel', issues: 3, demand: 168, capacity: 128, load: 131, status: 'bad' }
    ];
    const capacity = [
      { name: 'Alice Chen', hours: 40 },
      { name: 'Bob Martinez', hours: 40 },
      { name: 'Carol Kim', hours: 40 },
      { name: 'David Patel', hours: 32 }
    ];
    const violations = [
      { sev: 'error', key: 'DEMO-103', msg: 'Overdue by 3 days' },
      { sev: 'error', key: 'DEMO-104', msg: 'Blocked by DEMO-106 which finishes 2 days after this starts' },
      { sev: 'error', key: 'DEMO-111', msg: 'Due 5 days after parent Epic DEMO-100' },
      { sev: 'error', key: 'DEMO-107', msg: 'Overdue by 1 day' },
      { sev: 'warning', key: 'DEMO-108', msg: 'Missing start date and due date' },
      { sev: 'warning', key: 'DEMO-112', msg: 'Missing due date' },
      { sev: 'warning', key: 'DEMO-109', msg: 'Missing time estimate' },
      { sev: 'warning', key: 'DEMO-116', msg: 'Missing time estimate' },
      { sev: 'info', key: 'DEMO-115', msg: 'Missing start date (minor)' }
    ];
    const deps = [
      { key: 'DEMO-100', summary: 'Epic: Q1 Release', depth: 0 },
      { key: 'DEMO-101', summary: 'User authentication', depth: 1 },
      { key: 'DEMO-102', summary: 'Dashboard redesign', depth: 1 },
      { key: 'DEMO-104', summary: 'Database migration', depth: 2 },
      { key: 'DEMO-106', summary: 'Chart components', depth: 2 },
      { key: 'DEMO-108', summary: 'Payment gateway', depth: 3 },
      { key: 'DEMO-110', summary: 'Checkout flow', depth: 4 },
      { key: 'DEMO-111', summary: 'Mobile feature', depth: 5 }
    ];

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      initChart();  // Initialize chart FIRST
      render();     // Then render (which updates chart view)
      renderTeam();
      renderCapacity();
      renderViolations();
      renderDeps();
      initTabs();
    });

    function render() {
      const s = steps[step];
      document.getElementById('guide-body').innerHTML = s.html;
      document.getElementById('progress').style.width = ((step + 1) / steps.length * 100) + '%';
      document.getElementById('step-text').textContent = `Step ${step + 1} of ${steps.length}`;
      document.getElementById('step-name').textContent = s.name;
      document.getElementById('prev-btn').disabled = step === 0;
      document.getElementById('next-btn').textContent = step === steps.length - 1 ? 'Finish' : 'Next Step';

      // Switch tab
      switchTab(s.tab);

      // Highlight
      document.querySelectorAll('.highlight').forEach(e => e.classList.remove('highlight'));
      if (s.highlight) {
        const el = document.getElementById(s.highlight);
        if (el) el.classList.add('highlight');
      }

      // What-If
      if (s.showWhatIf) {
        document.getElementById('whatif-panel').style.display = 'block';
        document.getElementById('whatif-btn').classList.add('active');
      } else {
        document.getElementById('whatif-panel').style.display = 'none';
        document.getElementById('whatif-btn').classList.remove('active');
      }

      // Chart view
      if (s.chartView) {
        updateChartView(s.chartView);
      }
    }

    function nextStep() { if (step < steps.length - 1) { step++; render(); } }
    function prevStep() { if (step > 0) { step--; render(); } }

    function initTabs() {
      document.querySelectorAll('.tab').forEach(t => {
        t.addEventListener('click', () => switchTab(t.dataset.tab));
      });
    }

    function switchTab(id) {
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === id));
      document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === 'panel-' + id));
    }

    // Chart data storage
    let chartData = {};
    let currentChartView = null;

    function initChartData() {
      const labels = [];
      const dailyCap = [], dailyDem = [];
      const cumCap = [], cumDem = [], cumSpent = [];
      const completionPct = [];

      let cC = 0, cD = 0, cS = 0;
      const totalOriginalEstimate = 650;

      for (let i = 0; i < 20; i++) {
        const d = new Date(); d.setDate(d.getDate() - 5 + i);
        labels.push(d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

        const dCap = 32;
        const dDem = 28 + Math.sin(i * 0.5) * 12 + (i < 8 ? 10 : 0);
        dailyCap.push(dCap);
        dailyDem.push(Math.round(dDem * 10) / 10);

        cC += dCap;
        cD += dDem;
        cS += i < 5 ? 25 : 30;
        cumCap.push(cC);
        cumDem.push(Math.round(cD * 10) / 10);
        cumSpent.push(Math.round(cS * 10) / 10);
        completionPct.push(Math.round((cS / totalOriginalEstimate) * 100));
      }

      chartData = { labels, dailyCap, dailyDem, cumCap, cumDem, cumSpent, completionPct };
    }

    function initChart() {
      initChartData();
      createChart('cumulative'); // Default view
    }

    function createChart(view) {
      // Destroy existing chart
      if (chart) {
        chart.destroy();
        chart = null;
      }

      currentChartView = view;
      const ctx = document.getElementById('chart').getContext('2d');
      const legend = document.getElementById('chart-legend');

      let datasets, scales, legendHtml;

      switch (view) {
        case 'daily':
          datasets = [
            { label: 'Daily Capacity', data: chartData.dailyCap, borderColor: '#00875A', backgroundColor: 'rgba(0,135,90,0.1)', fill: true, tension: 0.1, borderWidth: 3, pointRadius: 3 },
            { label: 'Daily Demand', data: chartData.dailyDem, borderColor: '#0052CC', fill: false, tension: 0.1, borderWidth: 3, pointRadius: 3 }
          ];
          scales = { y: { beginAtZero: true, max: 55, title: { display: true, text: 'Hours per Day', font: { weight: 'bold' } } } };
          legendHtml = `
            <div class="legend-item"><div class="legend-color" style="background:#00875A"></div>Daily Capacity (32h)</div>
            <div class="legend-item"><div class="legend-color" style="background:#0052CC"></div>Daily Demand</div>
          `;
          break;

        case 'cumulative':
          datasets = [
            { label: 'Cumulative Capacity', data: chartData.cumCap, borderColor: '#00875A', backgroundColor: 'rgba(0,135,90,0.1)', fill: true, tension: 0.3, borderWidth: 3, pointRadius: 0 },
            { label: 'Cumulative Demand', data: chartData.cumDem, borderColor: '#0052CC', fill: false, tension: 0.3, borderWidth: 3, pointRadius: 0 }
          ];
          scales = { y: { beginAtZero: true, title: { display: true, text: 'Cumulative Hours', font: { weight: 'bold' } } } };
          legendHtml = `
            <div class="legend-item"><div class="legend-color" style="background:#00875A"></div>Cumulative Capacity</div>
            <div class="legend-item"><div class="legend-color" style="background:#0052CC"></div>Cumulative Demand</div>
          `;
          break;

        case 'spent':
          datasets = [
            { label: 'Cumulative Capacity', data: chartData.cumCap, borderColor: '#00875A', backgroundColor: 'rgba(0,135,90,0.1)', fill: true, tension: 0.3, borderWidth: 3, pointRadius: 0 },
            { label: 'Time Spent', data: chartData.cumSpent, borderColor: '#FF8B00', fill: false, tension: 0.3, borderWidth: 3, pointRadius: 0 }
          ];
          scales = { y: { beginAtZero: true, title: { display: true, text: 'Cumulative Hours', font: { weight: 'bold' } } } };
          legendHtml = `
            <div class="legend-item"><div class="legend-color" style="background:#00875A"></div>Cumulative Capacity</div>
            <div class="legend-item"><div class="legend-color" style="background:#FF8B00"></div>Time Spent (Logged)</div>
          `;
          break;

        case 'completion':
          datasets = [
            { label: 'Completion %', data: chartData.completionPct, borderColor: '#9C27B0', backgroundColor: 'rgba(156,39,176,0.1)', fill: true, tension: 0.3, borderWidth: 3, pointRadius: 0 }
          ];
          scales = { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Completion %', font: { weight: 'bold' } }, ticks: { callback: v => v + '%' } } };
          legendHtml = `
            <div class="legend-item"><div class="legend-color" style="background:#9C27B0"></div>Completion % (Time Spent √∑ Estimate)</div>
          `;
          break;

        default:
          datasets = [
            { label: 'Cumulative Capacity', data: chartData.cumCap, borderColor: '#00875A', backgroundColor: 'rgba(0,135,90,0.1)', fill: true, tension: 0.3, borderWidth: 2, pointRadius: 0 },
            { label: 'Cumulative Demand', data: chartData.cumDem, borderColor: '#0052CC', fill: false, tension: 0.3, borderWidth: 2, pointRadius: 0 }
          ];
          scales = { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } };
          legendHtml = `
            <div class="legend-item"><div class="legend-color" style="background:#00875A"></div>Capacity</div>
            <div class="legend-item"><div class="legend-color" style="background:#0052CC"></div>Demand</div>
          `;
      }

      legend.innerHTML = legendHtml;

      chart = new Chart(ctx, {
        type: 'line',
        data: { labels: chartData.labels, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: { legend: { display: false } },
          scales
        }
      });
    }

    function updateChartView(view) {
      if (view === currentChartView) return;
      createChart(view);
    }

    function renderTeam() {
      const c = document.getElementById('team-list');
      c.innerHTML = team.map(m => {
        const init = m.name.split(' ').map(n => n[0]).join('');
        const cls = m.load > 100 ? 'bad' : m.load > 85 ? 'warn' : 'ok';
        const lbl = { ok: 'On Track', warn: 'Near Capacity', bad: 'Overloaded' }[cls];
        return `<div class="team-member">
          <div class="avatar">${init}</div>
          <div class="member-info">
            <div class="member-name">${m.name}</div>
            <div class="member-stats"><span>${m.issues} issues</span><span>${m.demand}h demand</span><span>${m.capacity}h capacity</span></div>
            <div class="load-bar"><div class="load-fill ${cls}" style="width:${Math.min(m.load, 150)}%"></div></div>
          </div>
          <div class="status-tag ${cls}">${lbl}</div>
        </div>`;
      }).join('');
    }

    function renderCapacity() {
      const c = document.getElementById('cap-members');
      c.innerHTML = capacity.map((m, i) => `<div class="cap-member">
        <span>${m.name}</span>
        <input type="number" value="${m.hours}" onchange="updateCap(${i}, this.value)">
        <button onclick="removeCap(${i})">√ó</button>
      </div>`).join('');
      updateCapTotal();
    }

    function updateCap(i, v) { capacity[i].hours = parseInt(v) || 0; updateCapTotal(); }
    function removeCap(i) { capacity.splice(i, 1); renderCapacity(); }
    function updateCapTotal() { document.getElementById('cap-total').textContent = capacity.reduce((s, m) => s + m.hours, 0); }
    function setCapType(t) { document.querySelectorAll('.cap-row:first-child button').forEach((b, i) => b.classList.toggle('active', (t === 'team' ? i === 0 : i === 1))); }
    function setCapPeriod(p) { document.querySelectorAll('.cap-row:nth-child(2) button').forEach((b, i) => b.classList.toggle('active', (p === 'week' ? i === 0 : i === 1))); }
    function saveCapacity() { alert('Capacity saved! (Demo mode)'); }

    function renderViolations(filter = 'all') {
      const f = filter === 'all' ? violations : violations.filter(v => v.sev === filter);
      const icons = { error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
      document.getElementById('violations').innerHTML = f.map(v => `<div class="violation ${v.sev}">
        <div class="violation-icon">${icons[v.sev]}</div>
        <div class="violation-body"><span class="violation-key">${v.key}</span><div class="violation-msg">${v.msg}</div></div>
      </div>`).join('');
    }

    function filterV(f) {
      document.querySelectorAll('.filters button').forEach(b => b.classList.toggle('active', b.dataset.f === f));
      renderViolations(f);
    }

    function renderDeps() {
      document.getElementById('dep-list').innerHTML = deps.map(d => `<div class="dep-item">
        <div class="dep-depth">${d.depth}</div>
        <span class="dep-key">${d.key}</span>
        <span class="dep-summary">${d.summary}</span>
      </div>`).join('');
    }

    function toggleWhatIf() {
      const p = document.getElementById('whatif-panel');
      const b = document.getElementById('whatif-btn');
      const v = p.style.display !== 'block';
      p.style.display = v ? 'block' : 'none';
      b.classList.toggle('active', v);
    }

    function applyScenario() {
      const devs = parseInt(document.getElementById('dev-input').value) || 1;
      const hrs = parseInt(document.getElementById('hrs-input').value) || 8;
      const add = devs * hrs * 20;
      const newFeas = Math.min(100, Math.round((608 + add) / 613 * 100));
      const color = newFeas >= 80 ? 'var(--green)' : 'var(--yellow)';
      document.getElementById('score').textContent = newFeas + '%';
      document.getElementById('score').style.color = color;
      document.getElementById('feas-val').textContent = newFeas + '%';
      document.getElementById('feas-val').className = 'metric-val ' + (newFeas >= 80 ? 'ok' : 'warn');
      alert(`Scenario applied! Feasibility is now ${newFeas}%`);
    }
  </script>
</body>
</html>
